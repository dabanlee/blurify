{"version":3,"file":"blurify.js","sources":["../src/utils.js","../src/index.js"],"sourcesContent":["export function preloadImages(images) {\n    let newimages = [],\n        loadedImagesCount = 0,\n        postAction = function () {};\n\n    images = (typeof images != 'object') ? [images] : images;\n\n    function imageLoadPost() {\n        loadedImagesCount++;\n        if (loadedImagesCount == images.length) postAction(newimages);\n    }\n\n    images.map((image, i) => {\n        newimages[i] = new Image();\n        newimages[i].crossOrigin = '*';\n        newimages[i].src = !document.documentElement.dataset ? image.getAttribute('data-src') : image.dataset.src;\n        newimages[i].onload = function () {\n            imageLoadPost();\n        };\n        newimages[i].onerror = function () {\n            imageLoadPost();\n        };\n    });\n\n    return {\n        done(callback) {\n            postAction = callback || postAction;\n        },\n    };\n}\n\nexport function cssSupport(...args) {\n    let el = document.createElement('div'),\n        property = args[0],\n        value = args[1];\n    if (args.length === 1) {\n        return property in el.style ? true : false;\n    } else if (args.length === 2) {\n        el.style[property] = value;\n        return el.style[property] ? true : false;\n    } else {\n        return false;\n    }\n}\n\nexport function ie9lower() {\n\t\tlet\tv = 3,\n\t\tdiv = document.createElement('div'),\n\t\tall = div.getElementsByTagName('i');\n\n\t\twhile(\n\t\t\tdiv.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->',\n\t\t\tall[0]\n\t\t);\n\n\t\treturn (v > 4 && v <= 9) ? true : false;\n}\n","import {\n    preloadImages,\n    cssSupport,\n    ie9lower,\n} from './utils';\n\nexport default class blurify {\n    constructor(options) {\n        this.options = options;\n        this.blur = options.blur || 6;\n        this.mode = options.mode || 'css';\n        this.$els = options.images.nodeType === 1 ? [options.images] : [].slice.call(options.images);\n\n        if( ie9lower() ) {\n          this.useCanvasMode();\n        } else if (this.mode == 'auto') {\n            cssSupport('filter', 'blur(1px)') ? this.useCSSMode() : this.useCanvasMode();\n        } else if (this.mode == 'css') {\n            this.useCSSMode();\n        } else {\n            this.useCanvasMode();\n        }\n    }\n\n    useCSSMode() {\n        this.$els.map(el => {\n            el.src = !document.documentElement.dataset ? el.getAttribute('data-src') : el.dataset.src;\n            el.style['filter'] = el.style['-webkit-filter'] = `blur(${this.options.blur}px)`;\n        });\n    }\n\n    useCanvasMode() {\n        this.imageType = this.options.imageType || `image/jpeg`;\n        preloadImages(this.$els).done(images => {\n            images.map((image, index) => {\n                this.$els[index].src = this.getDataURL(image);\n            });\n        });\n    }\n\n    blurify(canvas, blur) {\n        let ctx = canvas.getContext('2d');\n        ctx.globalAlpha = 1 / (2 * blur);\n        for (let y = -blur; y <= blur; y += 2) {\n            for (let x = -blur; x <= blur; x += 2) {\n                ctx.drawImage(canvas, x, y);\n                if (x >= 0 && y >= 0) ctx.drawImage(canvas, -(x - 1), -(y - 1));\n            }\n        }\n        ctx.globalAlpha = 1;\n    }\n\n    getDataURL(image) {\n        let canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d');\n\n        canvas.width = image.width;\n        canvas.height = image.height;\n        ctx.drawImage(image, 0, 0);\n        this.blurify(canvas, this.blur);\n        return canvas.toDataURL(this.imageType);\n    }\n}\n"],"names":["preloadImages","images","newimages","loadedImagesCount","postAction","imageLoadPost","length","map","image","i","Image","crossOrigin","src","document","documentElement","dataset","getAttribute","onload","onerror","callback","cssSupport","el","createElement","property","value","style","ie9lower","v","div","all","getElementsByTagName","innerHTML","blurify","options","blur","mode","$els","nodeType","slice","call","useCanvasMode","useCSSMode","imageType","done","index","getDataURL","canvas","ctx","getContext","globalAlpha","y","x","drawImage","width","height","toDataURL"],"mappings":"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"}